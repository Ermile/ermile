(function(){window.saloos||(window.saloos=new Object)}).call(this),function(){$.fn.dataTableExt.sErrMode="throw",window.saloos.datatable=function(){function datatable(el){var e,first_data;if(el instanceof Element){try{first_data=JSON.parse($("tbody td:first",el).text())}catch(_error){e=_error,$("tbody td:first",el).html("<tr><td>Json paresError</td></tr>"),console.log(e)}first_data&&($(el).empty(),$(el).removeClass("hidden"),run.call(el,first_data))}else el.each(function(){return new window.saloos.datatable(this)})}var col_creat,data_compile,first_make_data,run;return first_make_data=!0,data_compile=Object(),col_creat=Object(),run=function(columns){var cl,lang,o_columns,obj;o_columns=Array(),columns.columns.id&&(columns.columns.id.table=!0);for(cl in columns.columns)columns.columns[cl].table&&(columns.columns[cl].title=columns.columns[cl].label,columns.columns[cl].name=cl,columns.columns[cl].data=cl,columns.columns[cl].className="col_"+columns.columns[cl].value,obj={title:columns.columns[cl].label,name:cl,data:cl,className:"col_"+columns.columns[cl].value,_resp:columns.columns[cl],createdCell:col_creat[columns.columns[cl].value]?col_creat[columns.columns[cl].value]:null},"id"===cl&&(obj.className="col_row"),o_columns.push(obj));return o_columns.push({orderable:!1,title:"",name:"id",data:"id",className:"col_actions",createdCell:col_creat.action?col_creat.action:null}),lang=document.documentElement.lang.slice(0,2)+".json",$(this).DataTable({language:{url:location.protocol+"//"+location.hostname.match(/([^\.]*)\.([^\.]*)$/)[0]+"/static/js/datatable/datatable-langs/"+lang},processing:!0,serverSide:!0,columns:o_columns,ajax:{cache:!0,url:$(this).attr("data-tablesrc"),beforeSend:function(){return first_make_data?(first_make_data=!1,this.error=0,this.success(columns),!1):0},data:function(data){var d,ret,val;ret=Array();for(d in data)data_compile[d]&&(val=data_compile[d](data[d],data),val&&ret.push(val));return ret.join("&")}},rowCallback:function(row,data,index){},createdRow:function(row,data,dataIndex){var len,num,sort,start,total;return len=this.fnSettings()._iDisplayLength,start=this.fnSettings()._iDisplayStart,sort=this.fnSettings().aaSorting[0][1],total=this.fnSettings()._iRecordsDisplay,"asc"===sort?num=dataIndex+start+1:(num=total-(dataIndex+start),data.num=num),$("td:first",row).text(num)}})},data_compile.order=function(order,data){var col_name;return col_name=data_compile.getColName(data,order[0].column),"sortby="+col_name+"&order="+order[0].dir},data_compile.search=function(search,data){return search.value?"search="+search.value:void 0},data_compile.length=function(length){return"length="+length},data_compile.start=function(start){return"start="+start},data_compile.draw=function(draw){return"draw="+draw},data_compile.getColName=function(data,col){return data.columns[col].name?data.columns[col].name:col},col_creat.action=function(td,cellData,rowData,row,col){var html,text;return text=$(td).text(),html=$('<span class="fa-stack fa-lg"> <i class="fa fa-square-o fa-stack-2x"></i> <a class="fa fa-pencil fa-stack-1x label-default" href="'+location.pathname+"/edit="+rowData.id+'"></a> </span> <span class="fa-stack fa-lg"> <i class="fa fa-square-o fa-stack-2x"></i> <a class="fa fa-times fa-stack-1x label-danger" href="'+location.pathname+"/delete="+rowData.id+'" data-data=\'{"id": '+rowData.id+'}\' data-method="post" data-modal="delete-confirm"></a> </span>'),$(td).html(html)},col_creat.title=function(td,cellData,rowData,row,col){var html,text;return text=$(td).text(),html=$("<a href='"+location.pathname+"/edit="+rowData.id+"'>"+text+"</a>"),$(td).html(html)},col_creat.url=function(td,cellData,rowData,row,col){var html,root,site_location,text;return text=$(td).text(),root=$("meta[name='site:root']").attr("content"),site_location=root+text,html=$("<a href='"+site_location+"?preview=yes'>"+text+"</a>"),$(td).html(html)},datatable}(),route("*",function(){return $("[data-tablesrc]",this).each(function(){return new window.saloos.datatable(this)})})}.call(this),function(){window.saloos.getParent=function(){function getParent(el){var name;name=$(el).attr("name"),$(el).removeAttr("name"),$('<input type="hidden" name="'+name+'" value="'+$(el).val()+'">').insertAfter($(el)),$(el).change(function(){var addr,val;return $(this).attr("disabled",""),val=$(this).val(),addr=location.pathname.replace(/\/[^\/]*$/,"")+"/options",$.ajax({url:addr,data:{parent:val,type:"getparent"},success:function(data){return console.log(data)}})})}return getParent}(),route("*",function(){return $("#sp-parent",this).each(function(){return new saloos.getParent(this)})})}.call(this);